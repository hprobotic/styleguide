<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Travelperk Style Guide</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./style.css">
  </head>
  <body>
    <div class="content">
      <h1>The TravelPerk Style Guide</h1>

      <div class="disclaimer" data-title="Disclaimer">
        This guide is a living document, expect it to change with time. Keep an eye on it to be up-to-date with our development practices.
      </div>

      <div id="toc"></div>

      <h2>Introduction</h2>

      <p>
      This document is a guide on how to write React applications at TravelPerk.
      </p>

      <h2>How to Setup a Project</h2>

      <p>
      Create you React projects using <em><a href="https://github.com/facebookincubator/create-react-app">Create React App</a></em> this will give you a solid starting point and free upgrades.
      Don't <a href="https://github.com/facebookincubator/create-react-app#converting-to-a-custom-setup">eject</a> unless you have a good reason for doing so.
      If you want to eject check with the rest of the team first.
      </p>

      <h3>Additional Tools</h3>

      <p>
      Once you have your project setup with Create React App, you will still need some extra configuration.
      </p>

      <h4>Node.js and npm</h4>

      <p>
      Make sure you specify your <a href="https://nodejs.org/en/">Node.js</a> version in an <code>.nvmrc</code> file for <a href="https://github.com/creationix/nvm">nvm</a> users.
      </p>
      <p>
      Try to use <a href="https://www.npmjs.com/"><code>npm</code></a> over <a href="https://yarnpkg.com/lang/en/"><code>yarn</code></a>. They are both great package managers but
      keeping the same version of <code>npm</code> among all developers in a team is easier than doing the same with <code>yarn</code>.
      </p>

      <h4>Flow</h4>

      <p>
      We try to type-check all our JavaScript files using <a href="https://flow.org/">Flow</a>. To install Flow, you can simply follow the <a href="https://flow.org/en/docs/install/">installation guide</a>.
      </p>

      <p>
      It's important that you execute <a href="https://github.com/flowtype/flow-typed"><code>flow-typed</code></a> after you setup Flow and every time you install, remove or update a node module.
      </p>

      <div class="idea" data-title="Idea">
        It would be useful if we could configure npm to run <code>flow-typed</code> automatically every time our modules list gets updated.
      </div>

      <h4>Prettier</h4>

      <p>
      Instead of having an extensive style guide dissecting where to put every white space we prefer to use <a href="https://github.com/prettier/prettier">Prettier</a> for automatic code formatting.
      </p>

      <p>
      Make sure  you follow the <a href="https://github.com/prettier/prettier#pre-commit-hook">official documentation</a> so that Prettier runs automatically for every new commit.
      </p>

      <h4>Codeship</h4>

      <p>TBD</p>

      <h3>Folder Structure</h3>

      <p>
      Follow the folder structure made by Create React App as much as possible. That means keeping all your configuration files in the root folder and all the code in <code>src</code>.
      </p>

      <p>
      Inside <code>src/</code> you're going to have a structure similar to the following:
      </p>

      <script src="https://gist.github.com/Gpx/5e6282929d9a8a18d29a86fe7c207b73.js"></script>

      <dl>
        <dt><code>api/</code></dt>
        <dd>
        Contains all the modules that make API requests
        </dd>
        <dt><code>app/</code></dt>
        <dd>
        Contains the whole app
        </dd>
        <dt><code>styles/</code></dt>
        <dd>
        Contains JavaScript modules with styling information. This folder may not be needed for some projects.
        </dd>
        <dt><code>types/</code></dt>
        <dd>
        Contains the Flow definitions for types that are not specified by <code>flow-typed</code>.
        </dd>
        <dt><code>utils/</code></dt>
        <dd>
        Any utility module goes here.
        </dd>
        <dt><code>index.js</code></dt>
        <dd>
        The main JavaScript files that bootstraps the whole application
        </dd>
        <dt><code>setupTests.js</code></dt>
        <dd>
        A file that gets executed before the tests are launched.
        </dd>
      </dl>

      <p>
      All the static files that are not imported via JavaScript&mdash;e.g. <code>index.html</code>, favicons&mdash;are placed in the <code>public/</code> folder.
      </p>

      <h2>Code Style</h2>

      <p>
      As said we leave code formatting to Prettier, there are also some <a href="http://eslint.org/">ESLint</a> rules that are automatically set by Create React App.
      </p>

      <div class="disclaimer" data-title="Warning">
      At the time of writing is not possible to configure custom ESLint rules without ejecting from Create React App.
      </div>

      <p>
      Here are some advices on how to write JavaScript code so that is more readable.
      </p>

      <ul>
        <li>Prefer <code>const</code> over <code>let</code>. Code written with constants is often more readable</li>
        <li>
          Never use comments to describe what your program is doing. The code should be easy to read and understand.
          Comments are a useful tool to explain why you wrote a portion of your program in a certain way but not to clarify what's going on in the program.
          Even worse, if you update your code the comments no longer describe your logic. Consider the following examples.

          <script src="https://gist.github.com/Gpx/59ce150791db7c354fef717faefee87e.js"></script>
        </li>
        <li>
          Learn <code>Array</code> methods, in particular <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code>Array.prototype.filter</code></a>,
          <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find"><code>Array.prototype.find</code></a>,
          <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes"><code>Array.prototype.includes</code></a>,
          <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"></code>Array.prototype.map</code></a>,
          <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach"></code>Array.prototype.forEach</code></a>,
          <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce"></code>Array.prototype.reduce</code></a> and,
          <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some"></code>Array.prototype.some</code></a>. With these methods you'll be able to get rid of loop statements 90% of the time.
        </li>
      </ul>

      <h2>How to Write a Component</h2>

      <p>
      There are two different kinds of components: Containers and Presentational—sometimes also called Smart and Dumb. You can read more about them <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">here</a>.
      </p>

      <h3>Presentational Components</h3>

      </p>
      Presentational Components are the easiest ones. Ideally, all they do is to take some data in—via <code>props</code>—and render it on the screen.
      A Presentational Component might have an internal state (e.g. if it handles an input element), but it should never communicate directly with the server.
      </p>

      <p>
      If possible create your Presentational Components using a functional component:
      </p>

      <script src="https://gist.github.com/Gpx/b7e8ecfa22a42a5a91796129ef7f1870.js"></script>

      <div class="info" data-title="Note">
        We're going to use Flow in all the examples. If you're not sure how to use it feel free to skip Flow's chapter.
      </div>

      <p>
      If you need helper methods, just create them in the same file or import them from a module.
      </p>

      <script src="https://gist.github.com/Gpx/c1939ca3390497f27eede6a9f6d7401e.js"></script>

      <p>
      Having several presentational components is OK. In fact, a good React application is made of many small components rather than few huge ones.
      Small components are easier to write, test and maintain.
      </p>

      <div class="info" data-title="Pro Tip">
        Don't worry too much about performance issues in the beginning. Fixing slow code will be faster if it's well written and easy to read.
      </div>

      <h3>Container Components</h3>

      <p>
      Containers Components take care of everything that is not strictly visual:
      </p>
      <ul>
        <li>Fetching data</li>
        <li>Handling the internal state of the application</li>
        <li>Notifying the server about updates</li>
        <li>Routing</li>
      </ul>
      <p>
      Every app has at least one Container called <code>&lt;App&gt;</code>.
      </p>

      <p>
      A container is defined as a <code>class</code> because it has to hold an internal state.
      </p>

      <script src="https://gist.github.com/Gpx/c3b7e3d46ea7eb88ca624df6bfc13063.js"></script>

      <p>
      In the previous example, we created a container called <code>&lt;MyPageContainer&gt;</code> and initialized its state to hold some users.
      </p>
      <p>
      The container is rendering <code>&lt;MyPage&gt;</code> which is a presentational component.
      </p>
      <p>
      As you can see <code>users</code> is initially <code>null</code> because we have to fetch the users from the server. Let's do it now.
      </p>

      <script src="https://gist.github.com/Gpx/431e000265be119f8af0484b01d2d8dc.js"></script>

      <p>
      Here we use <a href="https://facebook.github.io/react/docs/react-component.html#componentdidmount"><code>componentDidMount</code></a> to initiate the fetch.
      The <code>fetchUser</code> method is pretty straightforward, it loads the users and saves them in the state.
      </p>

      <p>
      Note that <code>componentDidMount</code> can initiate more than one fetch at the time.
      </p>

      <p>
      Lastly, we updated the <code>render</code> method so that it returns a <code>&lt;Loading&gt;</code> component while <code>users</code> is <code>null</code>.
      </p>

      <h4>Containers Inside Containers</h4>

      <p>
      Roughly speaking each container represents one segment in your URL path. For example, if your users visit <code>/settings/users</code> three container components will
      be activated: <code>&lt;App&gt;</code>, <code>&lt;SettingsContainer&gt;</code> and <code>&lt;UsersContainer&gt;</code>.
      </p>

      <p>
      The important thing is that all the containers have separate purposes. In our case, since <code>&lt;App&gt;</code> is loading the logged in user there's no need to fetch it
      again in <code>&lt;UsersContainer&gt;</code>.
      </p>

      <p>
      Make sure your folder structure maps the hierarchy in the containers.
      </p>

      <script src="https://gist.github.com/Gpx/c11e5cffa259a8f0f8350ff6605977dd.js"></script>

      <h4>Where to Put the Data</h4>

      <p>
      Given that your application is structured like a tree you want to store your data as close as possible to the leafs but avoiding repetition.
      </p>

      <p>
      Say your app has the following structure:
      </p>

      <img src="./app_tree.jpeg">

      <p>
      Here, each node represents a container. The currently logged user will potentially be used by all the components, so we'll store it in <code>&lt;App&gt;</code>'s state.
      </p>

      <p>
      On the other hand, the list of offices will only be used by <code>&lt;Offices&gt;</code>, so we'll keep it there.
      </p>

      <h3>Communicate Between Components</h3>

      <p>
      Communication between components is unidirectional. A father will pass data down to its children via props. If a child needs to notify one of its ancestors,
      it'll have to do that using a function passed as a prop.
      </p>

      <script src="https://gist.github.com/Gpx/fa2d93b17093a77fea6d14820b30be32.js"></script>

      <p>
      In the previous example you can see how <code>&lt;Child&gt;</code> receives <code>flag</code> from its parent and can also notify <code>&lt;Father&gt;</code> that
      a click happened using the <code>onFlagChange</code> function.
      </p>

      <h2>How to Style</h2>

      <p>
      You should avoid styling your components as much as possible. We have various components that provide basic styling such as <code>&lt;Layout&gt;</code> and <code>&lt;Spacer&gt;</code>.
      </p>

      <p>
      Before styling a component ask yourself these questions:
      </p>

      <ol>
        <li>Can I use one of the existing components?</li>
        <li>Seriously though, can I use one of the existing components?</li>
        <li>Can I modify or extend one of the existing components?</li>
      </ol>

      <p>
      If you answered <em>no</em> to all the previous questions, talk with your designer to see if it's possible to modify the design to use existing components.
      If that's not an option, define with the designer what's the best approach: creating a new general component or only one that will be used in your feature.
      </p>

      <div class="info" data-title="Note">
        The reason why it's so important to use existing components is that they are battle-tested, ensure visual consistency across the app, and they don't require you to write any custom styles.
      </div>

      <p>
      If you can't avoid styling use <a href="http://styled-components.com/">styled-components</a>.
      </p>

      <p>
      Try not to hard code values directly, instead create a <code>variables.js</code> file within <code>src/styles</code>.
      </p>

      <div class="disclaimer" data-title="Note">
        <code>tk-components</code> already has a module with our variables defined. Try to use it instead of defining your own values.
      </div>

      <h2>How to Test</h2>

      <h2>Flow and Data Types</h2>
    </div>

    <script src="./main.js"></script>
  </body>
</html>
